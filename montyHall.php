<?php

function getAsciiArt(): string
{
    return "
         
         ██╗                           ██████╗                      ██████╗
        ███║                           ╚════██╗                     ╚════██╗
        ╚██║                            █████╔╝                      █████╔╝
         ██║                           ██╔═══╝                       ╚═══██╗
         ██║                           ███████╗                     ██████╔╝
         ╚═╝                           ╚══════╝                     ╚═════╝ 
                                                                                              
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓                ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓                ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓                ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓                ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓                ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓                ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓                ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓██▓▓▓▓          ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▒▒▓▒░             ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒░░▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒░░▓▓▓▓        ░░▓░░░░░░           ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓       ░░░░░░░░░░░          ▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓       ░▒▒▓▓░░░░░░░░░░░░░░░░▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓░░░░░░░░░░░░░░░▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓ ░░░░░░░░░░░░░░░▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓  ░░░░░░░░░░░░░░▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓   ▒░░░░░░░░░░░░▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓   ▒▒░░░   ░▒▒░░▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓   ▒▒▒▒▒    ▒▒▒▒▓▓▓
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓███▓▓▓▓▓████▓▓▓
 
                 ┏┳┓┓┏┏┓  ┳┳┓┏┓┳┓┏┳┓┓┏  ┓┏┏┓┓ ┓   ┏┓┳┓┏┓┳┓┓ ┏┓┳┳┓
                  ┃ ┣┫┣   ┃┃┃┃┃┃┃ ┃ ┗┫  ┣┫┣┫┃ ┃   ┃┃┣┫┃┃┣┫┃ ┣ ┃┃┃
                  ┻ ┛┗┗┛  ┛ ┗┗┛┛┗ ┻ ┗┛  ┛┗┛┗┗┛┗┛  ┣┛┛┗┗┛┻┛┗┛┗┛┛ ┗
";
}

function simulateMontyHall($runs, $doors, $switch): int
{
    if ($runs < 1 || $runs > 1000000) {
        echo "The number of runs must be between 1 and 1000000.\n";
        return 1;
    }
    if ($doors < 3 || $doors > 100) {
        echo "The number of doors must be between 3 and 100.\n";
        return 1;
    }
    if (!in_array($switch, ['always', 'never', 'random'])) {
        echo "The switch option must be one of \"always\", \"never\", or \"random\".\n";
        return 1;
    }

    echo "Simulating the Monty Hall problem...\n";
    echo getAsciiArt();

    $start = microtime(true);

    $wins = 0;

    for ($i = 0; $i < $runs; $i++) {
        if (simulateGame($doors, $switch)) {
            $wins++;
        }
    }

    $winRate = ($wins / $runs) * 100;
    $loseRate = 100 - $winRate;

    echo "We ran $runs runs, using $doors doors and $switch switching.\n";
    echo "The result was $winRate% win and $loseRate% lose.\n";

    $time_elapsed_secs = microtime(true) - $start;

    echo "The time taken to run the simulation is $time_elapsed_secs seconds.\n";

    return 0;
}

function simulateGame($doors, $switch): bool
{
    $prizeDoor = rand(1, $doors);
    $choice = rand(1, $doors);

    if ($switch == 'always') {
        return switchDoor($choice, $prizeDoor, $doors);
    } elseif ($switch == 'never') {
        return $choice == $prizeDoor;
    } elseif ($switch == 'random') {
        if (rand(0, 1) == 1) {
            return switchDoor($choice, $prizeDoor, $doors);
        } else {
            return $choice == $prizeDoor;
        }
    }

    return false;
}

function switchDoor($choice, $prizeDoor, $doors): bool
{
    $revealedDoors = [];
    while (count($revealedDoors) < $doors - 2) {
        do {
            $reveal = rand(1, $doors);
        } while (in_array($reveal, $revealedDoors) || $reveal == $choice || $reveal == $prizeDoor);
        $revealedDoors[] = $reveal;
    }

    do {
        $newChoice = rand(1, $doors);
    } while ($newChoice == $choice || in_array($newChoice, $revealedDoors));

    return $newChoice == $prizeDoor;
}

// Retrieve options from command line
$options = getopt("", ["runs::", "doors::", "switch::"]);

$runs = $options['runs'] ?? null;
$doors = $options['doors'] ?? null;
$switch = $options['switch'] ?? null;

// Prompt for missing options
if ($runs === null) {
    $runs = readline("Enter the number of runs to simulate (1 to 1000000, default 1000): ");
    $runs = $runs === '' ? 1000 : (int)$runs;
}

if ($doors === null) {
    $doors = readline("Enter the number of doors (3 to 100, default 3): ");
    $doors = $doors === '' ? 3 : (int)$doors;
}

if ($switch === null) {
    $switch = readline("Enter the switching strategy (always, never, random, default always): ");
    $switch = $switch === '' ? 'always' : $switch;
}

// Validate and simulate the Monty Hall problem
simulateMontyHall($runs, $doors, $switch);